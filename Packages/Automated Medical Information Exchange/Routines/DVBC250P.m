DVBC250P ;ALB/BG - PATCH DVBA*2.7*250 POST-INSTALL ROUTINE; SEP 20, 2023@10:20 ; 10/24/23 2:31pm
 ;;2.7;AMIE;**250**;Apr 10, 1995;Build 19
 ; Per VHA Directive 6402 this routine should not be modified
 ; Reference to SUPPORTED PARAMETER TOOL ENTRY POINTS in ICR #2263
 Q
 ;
VUPDATE ; MINIMUM AND PREVIOUS CAPRI VERSION UPDATES
 N DVBVER
 D MES^XPDUTL("Patch DVBA*2.7*250 post install started")
 S DVBVER=$$ENXPAR("PKG","DVBAB CAPRI NF TOKEN URL","https://login.microsoftonline.com/{{TENANTID}}/oauth2/v2.0/token")
 D UPDMSG("DVBAB CAPRI NF TOKEN URL",DVBVER)
 S DVBVER=$$ENXPAR("PKG","DVBAB CAPRI NF SITEID URL","https://graph.microsoft.com/v1.0/sites/dvagov.sharepoint.com:/sites/OITEPMOCAPRICOMM")
 D UPDMSG("DVBAB CAPRI NF SITEID URL",DVBVER)
 S DVBVER=$$ENXPAR("PKG","DVBAB CAPRI NF DRIVEID URL","https://graph.microsoft.com/v1.0/sites/{{SITEID}}/drives")
 D UPDMSG("DVBAB CAPRI NF DRIVEID URL",DVBVER)
 S DVBVER=$$ENXPAR("PKG","DVBAB CAPRI NF FILEINFO URL","https://graph.microsoft.com/v1.0/drives/{{DRIVEID}}//root:/CAPRI Announcements:/children(''{{FILENAME}}'')")
 D UPDMSG("DVBAB CAPRI NF FILEINFO URL",DVBVER)
 S DVBVER=$$ENXPAR("PKG","DVBAB CAPRI MINIMUM VERSION","CAPRI GUI V2.7*250.7*1*A*3240105*1.3*1.3")
 D UPDMSG("CAPRI MINIMUM VERSION",DVBVER)
 S DVBVER=$$ENXPAR("PKG","DVBAB CAPRI PREVIOUS VERSION","DVBA*2.7*243.7")
 D UPDMSG("DVBAB CAPRI PREVIOUS VERSION",DVBVER)
 S DVBVER=$$ENXPAR("PKG","DVBAB CAPRI NF CLIENT","463b2348-85aa-40ba-81c8-af57fd0da97d@e95f1b23-abaf-45ee-821d-b7ab251ab3bf")
 D UPDMSG("DVBAB CAPRI NF CLIENT",DVBVER)
 S DVBVER=$$ENXPAR("PKG","DVBAB CAPRI NF TENANT","e95f1b23-abaf-45ee-821d-b7ab251ab3bf")
 D UPDMSG("DVBAB CAPRI NF TENANT",DVBVER)
 S DVBVER=$$ENXPAR("PKG","DVBAB CAPRI NF TOKEN","7xB8Q~74JE5Eh~5g3mn2ZNxbWSvtYkjnwWjfJbbw")
 D UPDMSG("DVBAB CAPRI NF TOKEN",DVBVER)
 D BMES^XPDUTL("Patch DVBA*2.7*250 post install finished")
 Q
 ;
ENXPAR(DVBENT,DVBPAR,DVBVAL) ;
 N DVBVER
 D EN^XPAR(DVBENT,DVBPAR,1,DVBVAL,.DVBVER)
 Q DVBVER
 ;
UPDMSG(DVBPAR,DVBVER) ;
 I DVBVER D
 . D BMES^XPDUTL(DVBPAR_" Update FAILURE.")
 . D MES^XPDUTL("  Failure reason: "_DVBVER)
 E  D
 . D BMES^XPDUTL(DVBPAR_" Updated Successfully")
 Q
