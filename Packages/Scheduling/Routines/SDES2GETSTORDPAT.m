SDES2GETSTORDPAT  ;ALB/BLB - SDES2 GET LAST SELECTED PAT; Sep 25, 2023@09:00
 ;;5.3;Scheduling;**861**;Aug 13, 1993;Build 17
 ;;Per VHA Directive 6402, this routine should not be modified
 Q
 ;
GETSTOREDPATIENT(JSON,SDCONTEXT,USER) ;
 N RETURN,DFN,ERRORS,PATIENTLIST,VALRETURN
 ;
 D VALFILEIEN^SDES2VALUTIL(.VALRETURN,.ERRORS,200,$G(USER("USER ID")),1,,441,442) ;
 D VALCONTEXT^SDES2VALCONTEXT(.ERRORS,.SDCONTEXT)
 I $D(ERRORS) M RETURN=ERRORS D BUILDJSON^SDES2JSON(.JSON,.RETURN) Q
 ;
 S DFN=$G(^DISV($G(USER("USER ID")),"^DPT("))
 I '$G(DFN) S RETURN("Patient",1)="" D BUILDJSON^SDES2JSON(.JSON,.RETURN) Q
 D POPULATE^SDESPATSEARCH(.PATIENTLIST,DFN,1)
 ;
 M RETURN=PATIENTLIST D BUILDJSON^SDES2JSON(.JSON,.RETURN)
 Q
 ;
