SDES ;ALB/BLB,LAB,KML,MGD,ANU,RRM,LAB,BLB - VISTA SCHEDULING RPCS ;APR 1,2022
 ;;5.3;Scheduling;**788,790,792,794,797,799,800,801,803,804,805,807,809,813,814**;Aug 13, 1993;Build 11
 ;;Per VHA Directive 6402, this routine should not be modified
 Q
 ; This routine documents the entry points for the new VS GUI version 3.0.
 ;
DISPOSITION(RET,ARIEN,DISP,DISPBY,DISPDT,EAS) ;RPC: SDES ARCLOSE
 D DISPOSITION^SDESARCLOSE(.RET,$G(ARIEN),$G(DISP),$G(DISPBY),$G(DISPDT),$G(EAS)) Q
ARGETIENJSON(RET,IEN,EAS) ;RPC: SDES GET PAT APPT REQ BY IEN
 D ARGETIENJSON^SDESARGET(.RET,$G(IEN),$G(EAS)) Q
ARGETPATJSON(RET,DFN,EAS) ;RPC: SDES PATIENT APPT REQ GET
 D ARGETPATJSON^SDESARGET(.RET,$G(DFN),$G(EAS)) Q
APPTBLOCKMOVE(RETURN,APPTIEN,SDRES,APPTDTTM,EAS) ; RPC: SDES CREATE APPT BLK AND MOVE
 D APPTBLOCKMOVE^SDESBLKANDMOVE(.RETURN,$G(APPTIEN),$G(SDRES),$G(APPTDTTM),$G(EAS)) Q
APPTBYCLINIC(JSON,CLINICIEN,SDBEG,SDEND,EAS) ;SDES GET APPT BY CLINIC
 D GETAPPTSBYCLINIC^SDESAPPT(.JSON,$G(CLINICIEN),$G(SDBEG),$G(SDEND),$G(EAS)) Q
APPTBYCLINICLIST(APPTLISTJSON,CLINICIENS) ;SDES GET APPTS BY CLINIC LIST
 D APPTBYCLINICLIST^SDESAPPT(.APPTLISTJSON,.CLINICIENS) Q
APPTBYRESOURCE(JSON,RESIEN,SDBEG,SDEND,EAS) ;SDES GET APPT BY RESOURCE
 D APPTBYRESOURCE^SDESAPPT(.JSON,$G(RESIEN),$G(SDBEG),$G(SDEND),$G(EAS)) Q
APPGETJSON(JSON,DFN,SDBEG,SDEND,EAS) ;
 D APPGETJSON^SDESAPPT(.JSON,$G(DFN),$G(SDBEG),$G(SDEND),$G(EAS)) Q
APPGETONEJSON(JSON,APPTIEN,EAS) ;
 D APPGETONEJSON^SDESAPPT(.JSON,$G(APPTIEN),$G(EAS)) Q
 ; Parameter list for APTREQCREATE and APTREQUPDATE   *MUST*  be kept in sync.
APTREQCREATE(JSON,ARIEN,DFN,AREDT,ARINST,ARTYPE,ARCLIN,ARUSER,ARREQBY,ARPROV,ARDAPTDT,ARCOMM,ARENPRI,ARMAR,ARMAI,AMRAN,ARPATCONT,ARSVCCON,ARSVCCOP,MRTCDT,ARSTOP,ARAPTYP,ARPATSTAT,MULTAPTMDE,ARPARENT,ARNLT,ARPRER,ARORDN,VAOSGUID,EAS) ;
 S ARIEN=""  ;There will never be an IEN when calling this RPC
 D ARSET Q
APTREQUPDATE(JSON,ARIEN,DFN,AREDT,ARINST,ARTYPE,ARCLIN,ARUSER,ARREQBY,ARPROV,ARDAPTDT,ARCOMM,ARENPRI,ARMAR,ARMAI,AMRAN,ARPATCONT,ARSVCCON,ARSVCCOP,MRTCDT,ARSTOP,ARAPTYP,ARPATSTAT,MULTAPTMDE,ARPARENT,ARNLT,ARPRER,ARORDN,VAOSGUID,EAS) ;
 S ARIEN=$G(ARIEN,"")
 S:ARIEN="" ARIEN=-1  ;Flag missing ARIEN when calling the update RPC
 D ARSET Q
ARSET ;Called from APTREQCREATE and APTREQUPDATE tags
 S DFN=$G(DFN),AREDT=$G(AREDT),ARINST=$G(ARINST),ARTYPE=$G(ARTYPE),ARCLIN=$G(ARCLIN),ARUSER=$G(ARUSER),ARREQBY=$G(ARREQBY),ARPROV=$G(ARPROV),ARDAPTDT=$G(ARDAPTDT),ARCOMM=$G(ARCOMM),ARENPRI=$G(ARENPRI)
 S ARMAR=$G(ARMAR),ARMAI=$G(ARMAI),AMRAN=$G(AMRAN),ARPATCONT=$G(ARPATCONT),ARSVCCON=$G(ARSVCCON),ARSVCCOP=$G(ARSVCCOP),MRTCDT=$G(MRTCDT),ARSTOP=$G(ARSTOP),ARAPTYP=$G(ARAPTYP),ARPATSTAT=$G(ARPATSTAT)
 S MULTAPTMDE=$G(MULTAPTMDE),ARPARENT=$G(ARPARENT),ARNLT=$G(ARNLT),ARPRER=$G(ARPRER),ARORDN=$G(ARORDN),VAOSGUID=$G(VAOSGUID)
 S EAS=$G(EAS)
 ; Because of an SAC limitation on the number of chars per line, addition of more parameters will require
 ; this to be changed over to passing an array.
 D ARSET^SDESAPTREQSET(.JSON,ARIEN,DFN,AREDT,ARINST,ARTYPE,ARCLIN,ARUSER,ARREQBY,ARPROV,ARDAPTDT,ARCOMM,ARENPRI,ARMAR,ARMAI,AMRAN,ARPATCONT,ARSVCCON,ARSVCCOP,MRTCDT,ARSTOP,ARAPTYP,ARPATSTAT,MULTAPTMDE,ARPARENT,ARNLT,ARPRER,ARORDN,VAOSGUID,EAS)
 Q
 ; Appointment Request Create/Edit
 ; SD*5.3*806
APTREQ44CRT(JSON,ARIEN,DFN,ARDAPTDT,ARLEN,ARRSN,ARUSER,ARODT,PATELG,AROVB) ; Create Appointment in #44
 N ARUPD
 S ARUPD=0
 D ARSET44
 Q
APTREQ44EDIT(JSON,ARIEN,DFN,ARDAPTDT,ARLEN,ARRSN,ARUSER,ARODT,PATELG,AROVB) ; Edit Appointment in #44
 N ARUPD
 S ARUPD=1
 D ARSET44
 Q
APTREQ40984CRT(JSON,SDAPTSTDTTM,SDAPTEDTTM,SDPATDFN,SDRESOURCE,SDATYPID,SDDDTTM,SDEXTID,SDAPTREQTYP,SDPROVIEN,SDCLNID,SDNOTE,SDAPTYP,SDEESTAT,SDAPTLEN,SDEAS) ; Create Appointment in #409.84
 D ARSET^SDESAPPTREQ40984(.JSON,$G(SDAPTSTDTTM),$G(SDAPTEDTTM),$G(SDPATDFN),$G(SDRESOURCE),$G(SDATYPID),$G(SDDDTTM),$G(SDEXTID),$G(SDAPTREQTYP),$G(SDPROVIEN),$G(SDCLNID),$G(SDNOTE),$G(SDAPTYP),$G(SDEESTAT),$G(SDAPTLEN),$G(SDEAS))
 Q
APTREQ40984EDIT(JSON,SDECAPTID,SDECNOTE,SDECLEN) ;Edit Appointment in SDEC APPOINTMENT File #409.84 - RPC: SDES EDIT APPT #409.84
 D EDITAPPT^SDESAPPTEDIT(.JSON,$G(SDECAPTID),$G(SDECNOTE),$G(SDECLEN))
 Q
ARSET44 ; Create/Edit Appointment in #44
 D ARSET^SDESAPTREQ44(.JSON,$G(ARUPD),$G(ARIEN),$G(DFN),$G(ARDAPTDT),$G(ARLEN),$G(ARRSN),$G(ARUSER),$G(ARODT),$G(PATELG),$G(AROVB))
 Q
ARCANCEL44(RETURN,SDDFN,SDCLNIEN,SDARDTTM) ; RPC: SDES CANCEL APPT #44
 D ARCANCEL44^SDESCANCELAPPT44(.RETURN,$G(SDDFN),$G(SDCLNIEN),$G(SDARDTTM)) Q
APTREQ2CRT(JSON,SDPATIENTDFN,SDCLNIEN,SDAPPTDTTM,SDLABDTTM,SDXRAYDTTM,SDEKGDTTM,SDVSTPURP,SDAPPTTYPE,SDCOLLATERAL,SDSCHREQTYPE,SDNXTAVAAPPT,SDFOLLOWUP) ; Create Appointment in #2
 N SDAPPTUPD
 S SDAPPTUPD=0
 D ARSET2
 Q
APTREQ2EDIT(JSON,SDPATIENTDFN,SDCLNIEN,SDAPPTDTTM,SDLABDTTM,SDXRAYDTTM,SDEKGDTTM,SDVSTPURP,SDAPPTTYPE,SDCOLLATERAL,SDSCHREQTYPE,SDNXTAVAAPPT,SDFOLLOWUP) ; Edit Appointment in #2
 N SDAPPTUPD
 S SDAPPTUPD=1
 D ARSET2
 Q
ARSET2 ; Create/Edit Appointment in #2
 D ARSET^SDESAPPTREQ2(.JSON,$G(SDAPPTUPD),$G(SDPATIENTDFN),$G(SDCLNIEN),$G(SDAPPTDTTM),$G(SDLABDTTM),$G(SDXRAYDTTM),$G(SDEKGDTTM),$G(SDVSTPURP),$G(SDAPPTTYPE),$G(SDCOLLATERAL),$G(SDSCHREQTYPE),$G(SDNXTAVAAPPT),$G(SDFOLLOWUP))
 Q
ARCANCEL2(RETURN,SDPATIENTDFN,SDCLNIEN,SDCANCELTYP,SDAPPTDTTM,SDCANCELDTTM,SDUSR,SDCANCELREASON,SDCANCELRMKS) ; RPC: SDES CANCEL APPT #2
 D ARCANCEL2^SDESCANCELAPPT2(.RETURN,$G(SDPATIENTDFN),$G(SDCLNIEN),$G(SDCANCELTYP),$G(SDAPPTDTTM),$G(SDCANCELDTTM),$G(SDUSR),$G(SDCANCELREASON),$G(SDCANCELRMKS)) Q
 ;
CANCELAPPT(SDECY,APPTIEN,STATUS,CANREAS,USER,EAS) ;SDES CANCEL APPT - cancel appointment
 D CANCELAPPT^SDESCANCELAPPT(.SDECY,$G(APPTIEN),$G(STATUS),$G(CANREAS),$G(USER),$G(EAS)) Q
 ;
CHECKIN(JSON,SDECAPTID,SDECCDT,SDECCC,SDECPRV) ;SDES APPT CHECKIN JSON
 D CHECKIN^SDES25(.JSON,$G(SDECAPTID),$G(SDECCDT),$G(SDECCC),$G(SDECPRV)) Q
 ;
 ;The parameter list for the clinic create and set use generic parameter names to ensure we stay in SAC compliance
 ;with the length of a single line.
CLINICCREATE(RET,P1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12,P13,P14,P15,P16,P17,P18,P19,P20,P21,P22,P23,P24,P25,P26,P27,P28,P29,P30,P31,P32,P33,P34,P35,P36,P37,P38,P39,P40) ;
 ;CLINICCREATE(RET,CLINIEN,R1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12,P13,P14,P15,P16,P17,P18,P19,P20,P21,P22,P23,P24,P25,P26,P27,P28,P29) ;
 S CLINIEN=""  ;There will never be an IEN when calling this RPC
 D CLINICSET Q
CLINICEDIT(RET,CLINIEN,P1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12,P13,P14,P15,P16,P17,P18,P19,P20,P21,P22,P23,P24,P25,P26,P27,P28,P29,P30,P31,P32,P33,P34,P35,P36,P37,P38,P39,P40) ;
 S CLINIEN=$G(CLINIEN,"")
 S:CLINIEN="" CLINIEN=-1  ;Flag missing ARIEN when calling the update RPC
 D CLINICSET Q
CLINICSET  ;Called from CLINICCREATE and CLINICUPDATE tags
 S P1=$G(P1),P2=$G(P2),P3=$G(P3),P4=$G(P4),P5=$G(P5),P6=$G(P6),P7=$G(P7),P8=$G(P8),P9=$G(P9),P10=$G(P10),P11=$G(P11),P12=$G(P12),P13=$G(P13),P14=$G(P14),P15=$G(P15),P16=$G(P16),P17=$G(P17)
 S P18=$G(P18),P19=$G(P19),P20=$G(P20),P21=$G(P21),P22=$G(P22),P23=$G(P23)
 S P24=$G(P24),P25=$G(P25),P26=$G(P26),P27=$G(P27),P28=$G(P28),P29=$G(P29),P30=$G(P30),P31=$G(P31),P32=$G(P32),P33=$G(P33),P34=$G(P34),P35=$G(P35),P36=$G(P36),P37=$G(P37),P38=$G(P38),P39=$G(P39),P40=$G(P40)
 D CLINICSET^SDESCLINICSET(.RET,CLINIEN,P1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12,P13,P14,P15,P16,P17,P18,P19,P20,P21,P22,P23,P24,P25,P26,P27,P28,P29,P30,P31,P32,P33,P34,P35,P36,P37,P38,P39,P40)
 Q
 ;
CLINICSEARCH(SDECY,SEARCHSTRING) ;Given a search string return a clinic list that matches.
 D CLINICSEARCH^SDESSEARCH(.SDECY,$G(SEARCHSTRING)) Q
CLINICRSCSEARCH(SDECY,SEARCHSTRING) ;Given a search string return a clinic list that matches.
 D CLINICRSC^SDES01C(.SDECY,$G(SEARCHSTRING)) Q
CREATEAPPTWRAPPR(JSONRETURN,APPTARRAY) ; SDES CREATE APPOINTMENTS ;Create appts in Files #409.84, #44, and #2.
 D CREATEAPPTS^SDESCRTAPPTWRAP(.JSONRETURN,.APPTARRAY) Q
GETREGA(SDECY,DFN,EAS) ;SDES GET REGISTRATION INFO
 D GETREGA^SDESGETREGA(.SDECY,$G(DFN),$G(EAS)) Q
INSURVERIFYREQ(JSON,DFN,EAS) ;SDES GET INSRUANCE VERIFY REQ
 D INSURVERIFYREQ^SDESPATRPC(.JSON,$G(DFN),$G(EAS)) Q
INSURINDICATORS(RETURN,DFNS) ;SDES GET INSURANCE VERIFY LIST
 D INSURINDICATORS^SDESPATRPC(.RETURN,.DFNS)
SPACEBAR(SDECY,SDECDIC,SDECVAL) ;EP Update ^DISV with most recent lookup value SDECVAL from file SDECDIC
 D SPACEBAR^SDES30(.SDECY,$G(SDECDIC),$G(SDECVAL)) Q
JSONINACTCLN(SDEC,CLINICIEN,EAS) ;EP RPC: SDES INACTIVATE CLINIC
 D JSONINACTCLN^SDESINACTCLINIC(.SDEC,$G(CLINICIEN),$G(EAS)) Q
JSONCLNINFO(SDEC,CLINICIEN,EAS) ;EP RPC: SDES GET CLINIC INFO
 D JSONCLNINFO^SDESRTVCLN(.SDEC,$G(CLINICIEN),$G(EAS)) Q
SETCLINAVAIL(RETURN,SDCLINIC,DATES,TIMES,SLOTS,SDEAS) ; RPC: SDES SET CLINIC AVAILABILITY
 D SETCLINAVAIL^SDESCLNSETAVAIL(.RETURN,$G(SDCLINIC),$G(DATES),$G(TIMES),$G(SLOTS),$G(SDEAS)) Q
GETCLNAVAILABLTY(RET,CLINICIEN,SDESSTART,SDESENDDATE,EAS) ;EP RPC: SDES GET CLINIC AVAILABILITY-retrieve clinic availablity in a given timeframe
 D GETCLAVAILABLTY^SDESCLINICAVAIL(.RET,$G(CLINICIEN),$G(SDESSTART),$G(SDESENDDATE),$G(EAS)) Q
CANCLNAVAILABLTY(RET,SDCLNIEN,SDESCANDATE,SDESSTRTIM,SDESENDTIM,SDCANREM,SDEAS) ;Called from RPC: SDES CANCEL CLINIC AVAILABILITY
 D CANCLAVAIL^SDESCCAVAIL(.RET,$G(SDCLNIEN),$G(SDESCANDATE),$G(SDESSTRTIM),$G(SDESENDTIM),$G(SDCANREM),$G(SDEAS)) Q
GETALLAPPTS(SDECY,DFN) ; SDES GET PATIENT APPTS BY DFN #2
 D GETALLAPPTS^SDESGETPATAPPT(.SDECY,$G(DFN)) Q
GETSINGLEAPPT(SDECY,DFN,DATETIME,CLINIC) ; SDES GET PATIENT APPT BY IEN #2
 D GETSINGLEAPPT^SDESGETPATAPPT(.SDECY,$G(DFN),$G(DATETIME),$G(CLINIC)) Q
GETUSRDTL(RET,SDSECID,EAS) ;Called from RPC: SDES GET USER PROFILE
 D GETUSRDTL^SDESGETUD(.RET,$G(SDSECID),$G(EAS)) Q
GETUSRDTLDUZ(RET,SDUSRIEN,EAS) ;Called from RPC: SDES GET USER PROFILE BY DUZ
 D GETUSRDTL^SDESGETUDDUZ(.RET,$G(SDUSRIEN),$G(EAS)) Q
RECGETLIST(SDECY,DFN,EAS) ; Get recalls based on patient DFN
 D RECGETLIST^SDESGETRECALL(.SDECY,$G(DFN),$G(EAS)) Q
RECGETONE(SDECY,IEN,EAS) ; Get recall based on IEN
 D RECGETONE^SDESGETRECALL(.SDECY,$G(IEN),$G(EAS)) Q
UPDRECALLREQ(RETN,RECALLIEN,DFN,ACCNO,SDCMT,FASTING,APPTP,RRPROVIEN,CLINIEN,APPTLEN,DATE,RECPPDT,DAPTDT,USERIEN,SECPDT,EAS) ;update recall request
 D UPDRECALLREQ^SDESUPDRECREQ(.RETN,$G(RECALLIEN),$G(DFN),$G(ACCNO),$G(SDCMT),$G(FASTING),$G(APPTP),$G(RRPROVIEN),$G(CLINIEN),$G(APPTLEN),$G(DATE),$G(RECPPDT),$G(DAPTDT),$G(USERIEN),$G(SECPDT),$G(EAS)) Q
CREATERECREQ(RETN,DFN,ACCNO,SDCMT,FASTING,APPTP,RRPROVIEN,CLINIEN,APPTLEN,DATE,RECPPDT,DAPTDT,USERIEN,SECPDT,SDENTDT,EAS) ;update recall request
 D CREATERECREQ^SDESUPDRECREQ(.RETN,$G(DFN),$G(ACCNO),$G(SDCMT),$G(FASTING),$G(APPTP),$G(RRPROVIEN),$G(CLINIEN),$G(APPTLEN),$G(DATE),$G(RECPPDT),$G(DAPTDT),$G(USERIEN),$G(SECPDT),$G(SDENTDT),$G(EAS)) Q
DISPRECALL(SDECY,RECALLIEN,REASON,COMMENT,EAS) ; for a PtCSch request, set disposition reason and DELETE  an entry  from the RECALL REMINDERS file 403.5
 D DISPRECALL^SDESDISPRECALL(.SDECY,$G(RECALLIEN),$G(REASON),$G(COMMENT),$G(EAS)) Q
GETAPPOINTMENTS(SDECY,SDCLIN,SDSTDTTM,SDENDDTTM) ;get appointments for clinic out of file 44
 D GETAPPOINTMENTS^SDESGETCLINAPPT(.SDECY,$G(SDCLIN),$G(SDSTDTTM),$G(SDENDDTTM)) Q
GETSTOPCODE(SDECY,SDSTCD) ;get stop code details out of file 40.7
 D GETSTCDDTL^SDESGETSTOPCODE(.SDECY,$G(SDSTCD)) Q
GETPATCHNUM(SDECY) ; get latest SD patch number installed on system
 D GETPATCHNUM^SDESPATCHINFO(.SDECY) Q
GETMISSIONELG(SDECY,APPTREQIEN,PID,APPTREQTYP,SDEAS) ;
 D GETMISSIONELG^SDESMISSIONELG(.SDECY,$G(APPTREQIEN),$G(PID),$G(APPTREQTYP),$G(SDEAS)) Q
PRINTPATAPPTS(SDECY,SDDFN,SDBEGIN,SDEND,EAS) ;print patient friend appointments
 S:$G(SDBEGIN)'="" SDBEGIN=$$ISOTFM^SDAMUTDT(SDBEGIN)
 S:$G(SDEND)'="" SDEND=$$ISOTFM^SDAMUTDT(SDEND)
 S:$G(SDBEGIN)="" SDBEGIN=$$NOW^XLFDT
 S:$G(SDEND)="" SDEND=$$FMADD^XLFDT(SDBEGIN,90)
 D PRINTPATAPPTS^SDESPRINTPATAPPT(.SDECY,$G(SDDFN),$G(SDBEGIN),$G(SDEND),$G(EAS)) Q
 Q
 ;Based on Patient DFN, retrieve and return all appointments associated with a patient from SDEC APPOINTMENT File #409.84,
 ;HOSPITAL LOCATION File #44, and the Appointment Multiple Patient File #2
GETAPPTWRAPDFN(SDECY,SDDFN,SDBEGIN,SDEND)   ;Called from RPC: SDES GET APPTS BY DFN #2
 N SDVIEWAPPTBY
 S SDVIEWAPPTBY=0
 D GETAPPTS^SDESGETAPPTWRAP(.SDECY,$G(SDDFN),$G(SDBEGIN),$G(SDEND))
 Q
 ;Based on CLINIC IEN, retrieve and return all appointments associated with a clinic from SDEC APPOINTMENT File #409.84,
 ;HOSPITAL LOCATION File #44, and the Appointment Multiple Patient File #2
GETAPPTWRAPCLIN(SDECY,SDCLINIEN,SDBEGIN,SDEND)  ;;Called from RPC: SDES GET APPTS BY CLINIC #44
 N SDVIEWAPPTBY
 S SDVIEWAPPTBY=1
 D GETAPPTS^SDESGETAPPTWRAP(.SDECY,$G(SDCLINIEN),$G(SDBEGIN),$G(SDEND))
 Q
