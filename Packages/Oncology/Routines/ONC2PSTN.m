ONC2PSTN ;Hines OIFO/RTK - Post-Install Routine for ONC*2.2*10 [cont] ;11/29/18
 ;;2.2;ONCOLOGY;**10**;Jul 31, 2013;Build 20
 ;
PASS4 ;
 D MES^XPDUTL("...pass 4 (of 5)...")
 S ONCDONE=0
 S IEN=0 F  S IEN=$O(^ONCO(165.5,IEN)) Q:IEN'>0  D 
 .S DATEDX=$P($G(^ONCO(165.5,IEN,0)),U,16)
 .S TOPIEN=$P($G(^ONCO(165.5,IEN,2)),U,1) Q:TOPIEN=""
 .S TOPCOD=$P($G(^ONCO(164,TOPIEN,0)),U,2)
 .S ONCTPCD=$P(TOPCOD,".",1)_$P(TOPCOD,".",2) ;remove the "."
 .S ONCHIST=$$HIST^ONCFUNC(IEN)
 .S HST14=$E(ONCHIST,1,4),ONCT3=$E(ONCTPCD,2,5)
 .S RAD1540=$P($G(^ONCO(165.5,IEN,3)),U,21)
 .S RAD3200=$P($G(^ONCO(165.5,IEN,24)),U,9)
 .I RAD1540=1,RAD3200=1 S RAD1514=1,RAD1515=1,RAD1511="00000",RAD1513="000" D SETPASS4 Q
 .I RAD1540=2,RAD3200>17 S RAD1514=10,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=3,RAD3200>17 S RAD1514=11,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=4,RAD3200>17 S RAD1514=12,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=5,RAD3200>17 S RAD1514=13,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I ((RAD1540=6)!(RAD1540=7))&(RAD3200>17) D  I ONCDONE=1 Q
 ..I ((HST14>9589)&(HST14<9730)) S RAD1514=2,RAD1515=10,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I (ONCT3="000")!((ONCT3>0)&(ONCT3<10))!((ONCT3>19)&(ONCT3<51))!((ONCT3>59)&(ONCT3<70)) S RAD1514=16,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I (ONCTPCD="C019")!((ONCT3>50)&(ONCT3<60))!((ONCT3>89)&(ONCT3<110))!(ONCTPCD="C140") S RAD1514=17,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I ((ONCT3>109)&(ONCT3<120)) S RAD1514=15,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I (ONCTPCD="C129")!((ONCT3>129)&(ONCT3<140))!((ONCT3>319)&(ONCT3<330)) S RAD1514=18,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..S RAD1514=22,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=8,RAD3200>17 S RAD1514=18,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=9,RAD3200>17 S RAD1514=19,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=10,RAD3200>17 S RAD1514=20,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=11,RAD3200>17 D  I ONCDONE=1 Q
 ..I ((HST14>9049)&(HST14<9056)) S RAD1514=24,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I ((HST14>8579)&(HST14<8589)) S RAD1514=25,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..S RAD1514=26,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=12,RAD3200>17 D  I ONCDONE=1 Q
 ..I ((HST14>9049)&(HST14<9056)) S RAD1514=24,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I ((HST14>8579)&(HST14<8589)) S RAD1514=25,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..S RAD1514=23,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=13,RAD3200>17 S RAD1514=30,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=14,RAD3200>17 S RAD1514=31,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=15,RAD3200>17 S RAD1514=36,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=16,RAD3200>17 S RAD1514=38,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=17,RAD3200>17 S RAD1514=42,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=18,RAD3200>17 D  I ONCDONE=1 Q
 ..I ((ONCT3>169)&(ONCT3<180)) S RAD1514=32,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I ((ONCT3>179)&(ONCT3<190)) S RAD1514=33,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..S RAD1514=39,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=19,RAD3200>17 D  I ONCDONE=1 Q
 ..I (RAD3200>35)&(RAD3200<42) S RAD1514=28,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I (RAD1540=20)&(((RAD3200>17)&(RAD3200<36))!(RAD3200>41)) S RAD1514=27,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=21,RAD3200>17 S RAD1514=29,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=22,RAD3200>17 S RAD1514=29,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=23,RAD3200>17 S RAD1514=65,RAD1515=10,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=24,RAD3200>17 S RAD1514=66,RAD1515=10,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=25,RAD3200>17 S RAD1514=54,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=26,RAD3200>17 S RAD1514=53,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=27,RAD3200>17 S RAD1514=56,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=28,RAD3200>17 S RAD1514=57,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=29,RAD3200>17 S RAD1514=58,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=30,RAD3200>17 D  I ONCDONE=1 Q
 ..I ((HST14>9589)&(HST14<9730)) S RAD1514=7,RAD1515=10,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I "C180^C181^C182^C183^C184^C185^C186^C187^C188^C189"[ONCTPCD S RAD1514=33,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I ONCTPCD="C209" S RAD1514=34,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I "C210^C211^C212^C213^C214^C215^C216^C217^C218"[ONCTPCD S RAD1514=35,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I "C510^C511^C512^C513^C514^C515^C516^C517^C518^C519"[ONCTPCD S RAD1514=51,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I ONCTPCD="C529" S RAD1514=52,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I ((ONCT3>529)&(ONCT3<560)) S RAD1514=50,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I ONCTPCD="C619" S RAD1514=44,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I ONCTPCD="C669" S RAD1514=43,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I "C670^C671^C672^C673^C674^C675^C676^C677^C678^C679"[ONCTPCD S RAD1514=40,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..S RAD1514=59,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=31,RAD3200>17 S RAD1514=61,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=32,RAD3200>17 S RAD1514=62,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=33,RAD3200>17 S RAD1514=63,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=34,RAD3200>17 S RAD1514=64,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=35,RAD3200>17 S RAD1514=40,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=36,RAD3200>17 S RAD1514=44,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=37,RAD3200>17 S RAD1514=50,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=38,RAD3200>17 S RAD1514=55,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=39,RAD3200>17 S RAD1514=60,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=40,RAD3200>17 S RAD1514=67,RAD1515=10,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=43,RAD3200>17 S RAD1514=14,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=44,RAD3200>17 S RAD1514=44,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=45,RAD3200>17 S RAD1514=21,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=46,RAD3200>17 S RAD1514=9,RAD1515=10,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=41,RAD3200>17 D  I ONCDONE=1 Q
 ..I ONCTPCD="C669" S RAD1514=43,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I ONCTPCD="C680" S RAD1514=46,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I "C600^C601^C602^C603^C604^C605^C606^C607^C608^C609"[ONCTPCD S RAD1514=47,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..I ((ONCT3>619)&(ONCT3<640)) S RAD1514=48,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 ..S RAD1514=69,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540=42,RAD3200>17 S RAD1514=70,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .I RAD1540'="",RAD3200>17 S RAD1514=68,RAD1515=11,RAD1511="99999",RAD1513="999" D SETPASS4 Q
 .Q
 ;
PASS5 ;
 D MES^XPDUTL("...pass 5 (of 5)...")
 S IEN=0 F  S IEN=$O(^ONCO(165.5,IEN)) Q:IEN'>0  D 
 .S DATEDX=$P($G(^ONCO(165.5,IEN,0)),U,16)
 .S TOPIEN=$P($G(^ONCO(165.5,IEN,2)),U,1) Q:TOPIEN=""
 .S TOPCOD=$P($G(^ONCO(164,TOPIEN,0)),U,2)
 .S ONCTPCD=$P(TOPCOD,".",1)_$P(TOPCOD,".",2) ;remove the "."
 .S ONCHIST=$$HIST^ONCFUNC(IEN)
 .S HST14=$E(ONCHIST,1,4),ONCT3=$E(ONCTPCD,2,5)
 .S RAD3200=$P($G(^ONCO(165.5,IEN,24)),U,9)
 .I RAD3200="" Q
 .I RAD3200=1 S RAD1516=1,RAD1512=1 D SETPASS5 Q
 .I (RAD3200=20)!(RAD3200=29) S RAD1516=2,RAD1512=2 D SETPASS5 Q
 .I RAD3200=21 S RAD1516=3,RAD1512=3 D SETPASS5 Q
 .I (RAD3200=22)!(RAD3200=23)!(RAD3200=24)!(RAD3200=25)!(RAD3200=26)!(RAD3200=27) S RAD1516=3,RAD1512=2 D SETPASS5 Q
 .I RAD3200=28 S RAD1516=5,RAD1512=4 D SETPASS5 Q
 .I RAD3200=30 S RAD1516=6,RAD1512=2 D SETPASS5 Q
 .I RAD3200=31 S RAD1516=3,RAD1512=6 D SETPASS5 Q
 .I RAD3200=32 S RAD1516=2,RAD1512=5 D SETPASS5 Q
 .I RAD3200=33 S RAD1516=4,RAD1512=2 D SETPASS5 Q
 .I RAD3200=34 S RAD1516=3,RAD1512=7 D SETPASS5 Q
 .I RAD3200=35 S RAD1516=3,RAD1512=8 D SETPASS5 Q
 .I RAD3200=36 S RAD1516=3,RAD1512=9 D SETPASS5 Q
 .I RAD3200=37 S RAD1516=8,RAD1512=12 D SETPASS5 Q
 .I RAD3200=38 S RAD1516=9,RAD1512=12 D SETPASS5 Q
 .I RAD3200=39 S RAD1516=10,RAD1512=12 D SETPASS5 Q
 .I RAD3200=40 S RAD1516=11,RAD1512=12 D SETPASS5 Q
 .I RAD3200=41 S RAD1516=12,RAD1512=12 D SETPASS5 Q
 .I (RAD3200=42)!(RAD3200=43) S RAD1516=14,RAD1512=12 D SETPASS5 Q
 .I RAD3200=44 S RAD1516=16,RAD1512=12 D SETPASS5 Q
 .I RAD3200=45 S RAD1516=17,RAD1512=12 D SETPASS5 Q
 .I RAD3200=18 S RAD1516=18,RAD1512=13 D SETPASS5 Q
 .I RAD3200=19 S RAD1516=18,RAD1512=14 D SETPASS5 Q
 .I ((RAD3200>1)&(RAD3200<18)) S RAD1516=18,RAD1512=13 D SETPASS5 Q
 .Q
 ;
 ;
 Q
 ;
SETPASS4 ;set the values for the new RAD fields - Pass 4
 S $P(^ONCO(165.5,IEN,"RAD18"),U,11)=RAD1514  ;PHASE 2 RAD TX VOL
 S $P(^ONCO(165.5,IEN,"RAD18"),U,12)=RAD1515  ;PHASE 2 RAD DRAINING LN
 S $P(^ONCO(165.5,IEN,"RAD18"),U,8)=RAD1511  ;PHASE 2 RAD DOSE PER FRAC
 S $P(^ONCO(165.5,IEN,"RAD18"),U,10)=RAD1513  ;PHASE 2 NUM OF FRACTIONS
 S ONCDONE=1
 Q
 ;
SETPASS5 ;set the values for the new RAD fields - Pass 5
 S $P(^ONCO(165.5,IEN,"RAD18"),U,13)=RAD1516  ;PHASE 2 RAD TX MODALITY
 S $P(^ONCO(165.5,IEN,"RAD18"),U,9)=RAD1512  ;PHASE 2 RAD EXT BEAM PLAN
 Q
