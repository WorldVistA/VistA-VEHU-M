WVRPCPT2 ;ISP/RFR - WV PATIENT FILE (790) APIS AND RPCS ;Mar 07, 2018@11:28
 ;;1.0;WOMEN'S HEALTH;**24**;Sep 30, 1998;Build 582
 Q
VERDATA(WVRETURN,WVDATA) ;VERIFY DATA FROM CLINICAL REMINDERS
 ; INPUT: WVRETURN - REFERENCE TO ARRAY IN WHICH TO RETURN STATUS
 ;                   [REQUIRED]
 ;        WVDATA - REFERENCE TO ARRAY OF DATA TO SAVE
 ;                 [REQUIRED]
 ;  OUTPUT: (0)=1 OR -1
 ;  OUTPUT: (n)=error message
 N CNT,WVFILE,WVVALDAT,WVERROR,WVIENS,WVFIELD,WVATTRS
 I '$D(WVDATA) S WVRETURN(0)=-1_U_"There is no data to validate." Q
 S WVFILE="",CNT=0 F  S WVFILE=$O(WVDATA("DATA",WVFILE)) Q:WVFILE=""  D
 .I "^790^790.05^790.17^790.16^790.9^790.1^790.4^790.23^"'[(U_WVFILE_U) S WVRETURN(1)=-1_U_"Invalid file number: "_WVFILE Q
 .I WVFILE=790 D 790(.WVDATA,.CNT,.WVRETURN)
 .I WVFILE=790.1 D 7901(.WVDATA,.CNT,.WVRETURN)
 .I WVFILE=790.4 D 7904(.WVDATA,.CNT,.WVRETURN)
 S WVFILE=1
 D CHKIENS^WVRPCPT(.WVDATA),VALS^DIE("","WVDATA(""DATA"")","WVVALDAT","WVERROR")
 K WVERROR
 S WVFILE=0 F  S WVFILE=$O(WVVALDAT(WVFILE)) Q:'+WVFILE  D
 .I "^790.9^"[(U_WVFILE_U) Q
 .S WVIENS="" F  S WVIENS=$O(WVVALDAT(WVFILE,WVIENS)) Q:WVIENS=""  S WVFIELD=0 F  S WVFIELD=$O(WVVALDAT(WVFILE,WVIENS,WVFIELD)) Q:'+WVFIELD  D
 ..Q:$G(WVVALDAT(WVFILE,WVIENS,WVFIELD))'=U
 ..D FIELD^DID(WVFILE,WVFIELD,"","LABEL;HELP-PROMPT","WVATTRS","WVERROR")
 ..I $D(WVERROR) S CNT=CNT+1,WVRETURN(CNT)="Field #"_WVFIELD_" in file #"_WVFILE_" has an error: "_$$FMERROR^WVUTL11(.WVERROR) Q
 ..S CNT=CNT+1,WVRETURN(CNT)="The "_$G(WVATTRS("LABEL"))_" field has an invalid value. "_$G(WVATTRS("HELP-PROMPT"))
 S WVRETURN(0)=$S(CNT>0:-1,1:1)
 Q
 ;
790(DATA,CNT,RETURN) ;
 K DATA("DATA",790)
 Q
 ;
7901(DATA,CNT,RETURN) ;
 N ARRAY,IEN,IENS,SUB,TEMP,X
 M ARRAY=DATA("DATA",790.1)
 S IENS="" F  S IENS=$O(ARRAY(IENS)) Q:IENS=""  D
 .I IENS[":" D
 ..K DATA("DATA",790.1,IENS)
 ..F X=1:1:$L(IENS,":") D
 ...S IEN=$P(IENS,":",X)
 ...M DATA("DATA",790.1,IEN)=ARRAY(IENS)
 S IENS="" F  S IENS=$O(ARRAY(IENS)) Q:IENS=""  D
 .S SUB="" F  S SUB=$O(DATA("DATA",790.1,IENS,SUB)) Q:SUB=""  D
 ..I SUB'>0 K DATA("DATA",790.1,IENS,SUB)
 Q
 ;
7904(DATA,CNT,RETURN) ;
 N ARRAY,DELARR,PAT,SUB,TEMP,VALUE
 S PAT=DATA("DFN")
 S SUB="" F  S SUB=$O(DATA("DATA",790.4,SUB)) Q:SUB=""  D
 .K DATA("DATA",790.4,SUB,.06),DATA("DATA",790.4,SUB,.01)
 .I SUB'>0 S TEMP(SUB)="" K DATA("DATA",790.4,SUB)
 I +$G(TEMP("F/U DATE"))>0,+$G(TEMP("F/U DATE"))<$$NOW^XLFDT S CNT=CNT+1,RETURN(CNT)="The Follow up date must be greater than now"
 Q
 ;
